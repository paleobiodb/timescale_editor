<!-- REQUIRES_LOGIN=1; -->
<!-- This web form implements an application for editing timescales the Paleobiology Database, -->
<!-- using the database's API.  The application -->
<!-- code resides in timescale_editor.js. -->
<!-- Author: Michael McClennen -->

<link rel="stylesheet" type="text/css" href="%%app_resources%%/timescale_editor.css">
<!-- <link rel="stylesheet" type="text/css" href="%%common_resources%%/pbdb_webapp.css"> -->
<script src="%%common_resources%%/jquery-2.0.3.min.js" language="JavaScript" type="text/javascript"></script>
<script src="%%common_resources%%/underscore-1.8.3.min.js" language="JavaScript" type="text/javascript"></script>
<script src="%%common_resources%%/pbdb_webapp.js" language="JavaScript" type="text/javascript"></script>
<script src="%%common_resources%%/pbdb_dynamic_content.js" language="JavaScript" type="text/javascript"></script>
<script src="%%app_resources%%/timescale_editor.js" language="JavaScript" type="text/javascript"></script>

<script language="JavaScript" type="text/javascript">
<!--
// This file is processed by the code in WebApp.pm when before it is sent to the client
// web browser, and the %%...%% literals are replaced by values known to the Classic environment.
// %%data_url%% is read from the Classic environment configuration file, and %%is_contributor%%
// is set to 1 if this page is being displayed for a logged-in user.  A standard header is also prepended, which
// defines some other javascript global variables and also provides the header bar for the
// resulting web page.

var tsapp = new TimescaleEditorApp('%%test_data_url%%', '%%app_resources%%', '%%is_contributor%%');
document.addEventListener("DOMContentLoaded", tsapp.initApp, false);

//  End -->
</script>

<!-- Section I of the application pane, with heading and explanatory note. -->

<div name="intro" style="margin-left: 1em; margin-right: 1em;">

  <p align="center" class="pageTitle" style="margin-top: 10px; margin-bottom: 10px">Edit Timescales</p>
  
  <p class="small"> This web app allows you to edit timescales in the Paleobiology Database.
  Its functionality is based on the PBDB
  <a class="dlBoldURL" target="_blank" href="%%data_url%%">data service</a>.</p>

  <p class="small">To learn more about the various parts of this form, use the
  <img width="16" height="16" src="/JavaScripts/img/hidden_help.png"> buttons.</p>
  
</div>

<!-- This box is visible when the application is first opened, and disappears once the -->
<!-- initialization steps are complete.  If it remains visible, something has gone wrong with the -->
<!-- initialization. -->

<div id="db_initmsg" class="tsed_modal" style="display: block">
  <span id="initmsg" class="tsed_modal_content" style="width: 300px">
  Initializing form, please wait...</span>
</div>

<!-- This section defines the mane editing pane, which is divided into two subpanes: one for -->
<!-- editing timescale attributes, and one for the intervals and interval boundaries. -->

<div name="editor" id="editor">
  <table border="1" width="100%">
    <tr>
      <td id="edit_selector" width="70%">
      	<div align="center">
  	  <div align="center" class="col-sm-6" id="edit_attrs"
	    onclick="tsapp.selectPane('ts_attrs_pane', 'edit_attrs')">Timescale attributes</div>
	  <div align="center" class="col-sm-6" id="edit_intervals"
	    onclick="tsapp.selectPane('intervals_pane', 'edit_intervals')">Intervals</div>
		</div>
      </td>
    </tr>
    <tr>
      <td id="ts_attrs_pane" style="vertical-align: top; display: none">
	<form id="ts_attrs_form" name="ts_attrs_form">
	    <div class="btn-holder">
	      <input type="button" class="btn" name="open" value="Open timescale" 
		     onclick="tsapp.openTimescaleAction()">
	      <input type="button" class="btn" name="new" value="New timescale" 
		     onclick="tsapp.newTimescaleAction()">
	      <input type="button" class="btn" name="delete" value="Delete timescale" 
		     onclick="tsapp.deleteTimescaleAction()">
	      <input type="button" class="btn" name="save" value="Save changes" 
		     onclick="tsapp.saveTimescaleAttrsAction()">
	      <input type="button" class="btn" name="revert" value="Revert" 
		     onclick="tsapp.revertTimescaleAttrsAction()">
	    </div>
	  <table id="ts_attrs_box" border="0" cellpadding="3">
	    <tr><td>Timescale name:</td>
	        <td><input id="ts_name" type="text" size="60" onchange="tsapp.checkTimescaleAttrs()"/>
		</td></tr>
	    <tr><td>Timescale id:</td>
		<td><input id="ts_id" type="text" size="8" disabled/> &nbsp;&nbsp;
		    <input id="ts_visible" type="checkbox" onchange="tsapp.checkTimescaleAttrs()"/> Visible &nbsp;&nbsp;
		    <input id="ts_enterable" type="checkbox" onchange="tsapp.checkTimescaleAttrs()"/> Enterable &nbsp;&nbsp;
		    <input id="ts_locked" type="checkbox" onchange="tsapp.checkTimescaleAttrs()"/> Locked &nbsp;&nbsp;
		    Priority: <select id="ts_priority" onchange="tsapp.checkTimescaleAttrs()">
			      <option value="">--</option></select>
	        </td></tr>
	    <tr><td>Age range:</td>
	        <td><input id="ts_min_age" type="text" size="10" disabled/> through
		    <input id="ts_max_age" type="text" size="10" disabled/> &nbsp;&nbsp;
		    Timescale type: 
		    <select id="ts_type" onchange="tsapp.checkTimescaleAttrs()"></select> &nbsp;&nbsp;
		</td></tr>
	    <tr><td>Timescale extent:</td>
	        <td><input id="ts_extent" type="text" size="60" onchange="tsapp.checkTimescaleAttrs()"/>
		</td></tr>
	    <tr><td>Timescale taxon:</td>
	        <td><input id="ts_taxon" type="text" size="60" onchange="tsapp.checkTimescaleAttrs()"/>
	        </td></tr>
	    <tr><td>Timescale reference:</td>
	        <td><input id="ts_refid" type="text" size="10" onchange="tsapp.checkTimescaleAttrs()">
	        </td></tr>
	    <tr><td></td><td><textarea id="ts_ref" class="tsed_attr_field" rows=2 disabled></textarea>
		</td></tr>
	    <tr><td>Timescale comments:</td>
	        <td><textarea id="ts_comments" class="tsed_attr_field" rows=2
		     onchange="tsapp.checkTimescaleAttrs()"></textarea>
		</td></tr>
	</table>
	</form>
	</td>
      <td id="intervals_pane" style="vertical-align: top; height: 500px; display: none">
	<form id="intervals_form" name="intervals_form">
	    <h3 class="tsed_box_header" id="ts_name_intervals"></h3>
	    <div class="btn-holder">
	      <input type="button" class="btn" name="open" value="Open timescale"
		onclick="tsapp.openTimescaleAction()">
	      <input type="button" class="btn" name="add" value="Add intervals"
		onclick="tsapp.addIntervalsAction()">
	      <input type="button" class="btn" name="save" value="Save changes"
		onclick="tsapp.saveIntervalsAction()">
	      <input type="button" class="btn" name="export" value="Export intervals"
		onclick="tsapp.exportIntervalsAction()">
	      <input type="button" class="btn" name="revert" value="Revert"
		onclick="tsapp.revertIntervalsAction()">
	    </div>
	    <table id="timescale_content_box" width="100%">
	      <tr><td class="timescale_content_cell">
		<table id="intervals_box" width="100%"><tr><td height="200px">&nbsp;</td></tr></table>
	      </td></tr>
	      <tr><td class="timescale_content_cell">
		<table id="bound_editor">
		  <tr>
		    <td colspan="3" style="text-align: center"><div id="be_title" class="tsed_subbox_header"></div></tr>
		  <tr>
		    <td>Next&nbsp;up:</td>
		    <td><select id="be_top_bound" onchange="tsapp.checkBoundEditor('top_bound')"></select></td>
		    <td><div id="be_error_msg" style="color: red"></div></td></tr>
		  <tr>
		    <td width="5%">
		      Above:<br/>
		      Below:</td>
		    <td width="20%">
		      <input id="be_intname" type="text" size="30" onchange="tsapp.checkBoundEditor('intname')">
		      <hr/>
		      <input id="be_lower" type="text" size="30" onchange="tsapp.checkBoundEditor('lower')"></td>
		    <td style="padding-top: 5px">
		      <input id="be_age" type="text" size="8" onchange="tsapp.checkBoundEditor('age')"> &plusmn;
		      <input id="be_age_err" type="text" size="5" onchange="tsapp.checkBoundEditor('age_err')"> &nbsp;
		      <img id="be_spike" class="tsed_spike" width="20" height="20"/> &nbsp; &nbsp;
		      <select id="be_bound_type" onchange="tsapp.checkBoundEditor('type')">
			<option value="">--</option>
		      </select> &nbsp;
		      <select id="be_bound_link" onchange="tsapp.checkBoundEditor('link')">
			<option value="">--</option>
		      </select> &nbsp;
		      <!-- <div id="be_range_bound" style="display: inline" class="tsed_timescale_label" -->
		      <!-- 	onclick="tsapp.checkBoundEditor('bounds')">&nbsp;</div> &nbsp; -->
		      <input id="be_fraction" type="text" size="8"
			onchange="tsapp.checkBoundEditor('fraction')"> &nbsp;
		      <div class="btn-holder" style="float: right">
			<input type="button" class="btn" name="redisplay" value="Redisplay"
				onclick="tsapp.redisplayIntervalsAction()"/></div>
		    </td></tr>
		</table>
	      </td></tr></table>
	 </form>
      </td></tr>
    </table>
</div>

<!-- The following boxes are modal dialogs, and only appear when -->
<!-- timescale and bound references are being selected. -->

<div id="timescale_selector" class="tsed_modal">

  <div class="tsed_modal_content" style="height: 500px">
    <span class="close" onclick="tsapp.modalClose('timescale_selector')">&times;</span>
    <h3>Select a timescale:</h3>
    <input id="tsel_input" type="text" size="1" onkeydown="tsapp.openTimescaleKeypress('timescale_selector', event)">
    <table id="timescale_selector_timescales" style="display: block; height: 400px; overflow: scroll; text-align: left">
    </table>
  </div>

</div>
    

<div id="bound_selector" class="tsed_modal">

  <div class="tsed_modal_content" style="height: 500px">
    <span class="close" onclick="tsapp.modalClose('bound_selector')">&times;</span>
    <h3>Select a boundary from one of the following timescales:</h3>
    <table width="80%" style="height: 450px;" cellpadding="5" style="text-align: left">
      <tr style="vertical-align: top">
	<td width="40%">
	  <table id="bound_selector_timescales" style="display: block; height: 400px; overflow: scroll">
	  </table></td>
	 <td><table id="bound_selector_bounds" style="display: block; height: 400px; overflow: scroll">
	</table></td></tr>
    </table>
  </div>

</div>

<!-- The following modal dialog box is used to for adding new intervals to a timescale. -->

<div id="add_intervals" class="tsed_modal">

  <div class="tsed_modal_content" style="height: 500px">
    <span class="close" onclick="tsapp.modalClose('add_intervals')">&times;</span>
    <h3 class="tsed_box_header" id="ts_name_add_intervals">Add Intervals</h3>
    <table id="add_intervals_box" style="">
      <thead>
	<tr style="vertical-align: top; height: 30px"><td>Interval names</td><td>Boundary ages</td></tr>
      </thead><tbody>
	<tr><td></td>
	    <td><input type="text" id="ia_age_0" size="8" onchange="tsapp.addIntervalsCheck('age', 0)"
			class="tsed_add_age"/><input type="hidden" id="ia_type_0"></td>
	    <td><select id="ia_select_0" onchange="tsapp.addIntervalsCheck('link', 0)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_0" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 0)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_1" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_1" size="8" onchange="tsapp.addIntervalsCheck('age', 1)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_1"></td>
	    <td><select id="ia_select_1" onchange="tsapp.addIntervalsCheck('link', 1)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_1" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 1)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_2" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_2" size="8" onchange="tsapp.addIntervalsCheck('age', 2)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_2"></td>
	    <td><select id="ia_select_2" onchange="tsapp.addIntervalsCheck('link', 2)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_2" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 2)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_3" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_3" size="8" onchange="tsapp.addIntervalsCheck('age', 3)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_3"></td>
	    <td><select id="ia_select_3" onchange="tsapp.addIntervalsCheck('link', 3)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_3" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 3)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_4" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_4" size="8" onchange="tsapp.addIntervalsCheck('age', 4)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_4"></td>
	    <td><select id="ia_select_4" onchange="tsapp.addIntervalsCheck('link', 4)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_4" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 4)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_5" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_5" size="8" onchange="tsapp.addIntervalsCheck('age', 5)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_5"></td>
	    <td><select id="ia_select_5" onchange="tsapp.addIntervalsCheck('link', 5)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_5" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 5)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_6" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_6" size="8" onchange="tsapp.addIntervalsCheck('age', 6)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_6"></td>
	    <td><select id="ia_select_6" onchange="tsapp.addIntervalsCheck('link', 6)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_6" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 6)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_7" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_7" size="8" onchange="tsapp.addIntervalsCheck('age', 7)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_7"></td>
	    <td><select id="ia_select_7" onchange="tsapp.addIntervalsCheck('link', 7)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_7" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 7)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_8" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_8" size="8" onchange="tsapp.addIntervalsCheck('age', 8)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_8"></td>
	    <td><select id="ia_select_8" onchange="tsapp.addIntervalsCheck('link', 8)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_8" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 8)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_9" size="30" class="tsed_add_interval"/></td>
	    <td><input type="text" id="ia_age_9" size="8" onchange="tsapp.addIntervalsCheck('age', 9)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_9"></td>
	    <td><select id="ia_select_9" onchange="tsapp.addIntervalsCheck('link', 9)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_9" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 9)" disabled></td></tr>
	<tr><td><input type="text" id="ia_name_10" size="30" class="tsed_add_interval/"></td>
	    <td><input type="text" id="ia_age_10" size="8" onchange="tsapp.addIntervalsCheck('age', 10)"
		       class="tsed_add_age"/><input type="hidden" id="ia_type_10"></td>
	    <td><select id="ia_select_10" onchange="tsapp.addIntervalsCheck('link', 10)" class="tsed_add_age">
	        </select>&nbsp;&nbsp;<input type="text" id="ia_frac_10" size="8" class="tsed_add_age"
			onchange="tsapp.addIntervalsCheck('frac', 10)" disabled></td></tr>
	<tr><td class="btn-holder">
	  <input type="button" class="btn" name="save" value="Save"
		onclick="tsapp.addIntervalsSaveAction()"/>
	  <input type="button" class="btn" name="cancel" value="Cancel"
	        onclick="tsapp.modalClose('add_intervals')"/>
	  &nbsp;&nbsp;
	  <input type="button" class="btn" name="clear" value="Clear form"
		onclick="tsapp.addIntervalsClearAction()"/>
	  </td><td></tr></tr>
      </tbody>
    </table>
  </div>

</div>
