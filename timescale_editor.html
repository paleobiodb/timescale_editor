<!-- REQUIRES_LOGIN=1; -->
<!-- This web form implements an application for editing timescales the Paleobiology Database, -->
<!-- using the database's API.  The application -->
<!-- code resides in timescale_editor.js. -->
<!-- Author: Michael McClennen -->

<link rel="stylesheet" type="text/css" href="%%app_resources%%/timescale_editor.css">
<link rel="stylesheet" type="text/css" href="%%common_resources%%/pbdb_webapp.css">
<script src="%%common_resources%%/jquery-2.0.3.min.js" language="JavaScript" type="text/javascript"></script>
<script src="%%common_resources%%/underscore-1.8.3.min.js" language="JavaScript" type="text/javascript"></script>
<script src="%%common_resources%%/pbdb_webapp.js" language="JavaScript" type="text/javascript"></script>
<script src="%%common_resources%%/pbdb_dynamic_content.js" language="JavaScript" type="text/javascript"></script>
<script src="%%app_resources%%/timescale_editor.js" language="JavaScript" type="text/javascript"></script>

<script language="JavaScript" type="text/javascript">
<!--
// This file is processed by the code in WebApp.pm when before it is sent to the client
// web browser, and the %%...%% literals are replaced by values known to the Classic environment.
// %%data_url%% is read from the Classic environment configuration file, and %%is_contributor%%
// is set to 1 if this page is being displayed for a logged-in user.  A standard header is also prepended, which
// defines some other javascript global variables and also provides the header bar for the
// resulting web page.

var tsapp = new TimescaleEditorApp('%%test_data_url%%', '%%app_resources%%', '%%is_contributor%%');
document.addEventListener("DOMContentLoaded", tsapp.initApp, false);

//  End -->
</script>

<!-- Section I of the application pane, with heading and explanatory note. -->

<div name="intro" style="margin-left: 1em; margin-right: 1em;">

  <p align="center" class="pageTitle" style="margin-top: 10px; margin-bottom: 10px">Edit Timescales</p>
  
  <p class="small"> This web app allows you to edit timescales in the Paleobiology Database.
  Its functionality is based on the PBDB
  <a class="dlBoldURL" target="_blank" href="%%data_url%%">data service</a>.</p>

  <p class="small">To learn more about the various parts of this form, use the
  <img width="16" height="16" src="/JavaScripts/img/hidden_help.png"> buttons.</p>
  
</div>

<!-- This box is visible when the application is first opened, and disappears once the -->
<!-- initialization steps are complete.  If it remains visible, something has gone wrong with the -->
<!-- initialization. -->

<div id="db_initmsg" class="tsed_modal" style="width: 300px; height: 100px;">
	<span id="initmsg" class="large">Initializing form, please wait...</span>
</div>

<div name="editor" id="editor">
  <table border="1" width="100%">
    <tr>
      <td id="edit_selector" width="70%">
      	<div align="center">
  			<div align="center" class="col-sm-6" id="edit_attrs" onclick="tsapp.selectPane('ts_attrs_pane', 'edit_attrs')">Timescale attributes</div>
			<!-- <div align="center" class="col-sm-4" id="edit_bounds" onclick="tsapp.selectPane('bounds_pane', 'edit_bounds')">Bounds</div> -->
			<div align="center" class="col-sm-6" id="edit_intervals" onclick="tsapp.selectPane('intervals_pane', 'edit_intervals')">Intervals</div>
		</div>
      </td>
    </tr>
    <tr>
      <!-- <td id="ts_list" style="vertical-align: top; height:500px;"> -->
      <!-- 		<div style="max-height: 500px; overflow: auto;"> -->
      <!-- 			<table id="timescales_box" border="1"> -->
      <!-- 			</table> -->
      <!-- 		</div> -->
      <!-- </td> -->
      <td id="ts_attrs_pane" style="vertical-align: top; display: none">
	<form id="ts_attrs_form" name="ts_attrs_form">
	    <div class="btn-holder">
	      <input type="button" class="btn" name="open" value="Open timescale" onclick="tsapp.openTimescale()">
	      <input type="button" class="btn" name="new" value="New timescale" onclick="tsapp.newTimescale()">
	      <input type="button" class="btn" name="delete" value="Delete timescale" onclick="tsapp.deleteTimescale()">
	      <input type="button" class="btn" name="save" value="Save changes" onclick="tsapp.saveTimescaleAttrs()">
	      <input type="button" class="btn" name="revert" value="Revert" onclick="tsapp.revertTimescaleAttrs()">
	    </div>
	  <table id="ts_attrs_box" border="0" cellpadding="3">
	    <tr><td>Timescale name:</td>
	        <td><input id="ts_name" type="text" size="40" onchange="tsapp.checkTimescaleAttrs()"/>
		</td></tr>
	    <tr><td>Age range:</td>
	        <td><input id="ts_min_age" type="text" size="10" disabled/> through
		  <input id="ts_max_age" type="text" size="10" disabled/>
		</td></tr>
	    <tr><td>Timescale type:</td>
	        <td><select id="ts_type" onchange="tsapp.checkTimescaleAttrs()"></select>
		  <span style="margin-left: 20px;">Timescale id:<span>
	            <input id="ts_id" type="text" size="8" disabled/>		
	        </td></tr>
	    <tr><td>Timescale extent:</td>
	        <td><input id="ts_extent" type="text" size="40" onchange="tsapp.checkTimescaleAttrs()"/>
		</td></tr>
	    <tr><td>Timescale taxon:</td>
	        <td><input id="ts_taxon" type="text" size="40" onchange="tsapp.checkTimescaleAttrs()"/>
	        </td></tr>
	    <tr><td>Timescale comments:</td>
	        <td><textarea id="ts_comments" rows=2 columns=40 onchange="tsapp.checkTimescaleAttrs()">
		    </textarea>
	        </td></tr>
	</table>
	</form>
	    <div class="btn-holder">
	      <input type="button" class="btn" name="new" value="New timescale" onclick="tsapp.newTimescale()">
	      <input type="button" class="btn" name="delete" value="Delete this timescale" onclick="tsapp.deleteTimescale()">
	    </div>
	</td>
      <td id="bounds_pane" style="vertical-align: top; height: 500px; display: none">
      	<form id="bounds_form" name="bounds_form">
      	    <h3 class="tsed_box_header" id="ts_name_bounds"></h3>
      	    <div class="btn-holder">
      	      <input type="button" class="btn" name="open" value="Open timescale" onclick="tsapp.openTimescale()">
      	      <input type="button" class="btn" name="save" value="Save changes" onclick="tsapp.saveBoundsForm()">
      	      <input type="reset" class="btn" name="reset" value="Reset">
      	    </div>
      		<table id="bounds_box_header"><tbody><tr>
      			<td>Interval bounds</td>
      			<td style="text-align: right;">Based on</td>
      		</tr></tbody></table>
      	  <div style="max-height: 500px; overflow: auto">
      	    <table id="bounds_box" border="1" style="margin-top: 20px;">
      	    </table></div>
      	  </form>
      	 </td>
      <td id="intervals_pane" style="vertical-align: top; height: 500px; display: none">
	    <h3 class="tsed_box_header" id="ts_name_intervals"></h3>
	    <div class="btn-holder">
	      <input type="button" class="btn" name="open" value="Open timescale" onclick="tsapp.openTimescale()">
	      <input type="button" class="btn" name="add" value="Add intervals" onclick="tsapp.addIntervals()">
	      <input type="button" class="btn" name="save" value="Save changes" onclick="tsapp.saveIntervals()">
	      <input type="button" class="btn" name="export" value="Export intervals" onclick="tsapp.exportIntervals()">
	      <input type="button" class="btn" name="revert" value="Revert" onclick="tsapp.revertIntervals()">
	    </div>
	    <table id="timescale_content_box" width="100%">
	      <tr><td class="timescale_content_cell">
		<table id="intervals_box" width="100%"><tr><td height="200px">&nbsp;</td></tr></table>
	      </td></tr>
	      <tr><td class="timescale_content_cell">
		<form id="intervals_form" name="intervals_form">
		<table id="bound_editor">
		  <tr>
		    <td colspan="3" style="text-align: center"><div id="be_title" class="tsed_subbox_header"></div></tr>
		  <tr>
		    <td>Next&nbsp;up:</td>
		    <td><select id="be_top_bound" onchange="tsapp.checkBoundEditor('top_bound')"></div></td>
		    <td><div id="bound_editor_msg" style="display: none"></div></td></tr>
		  <tr>
		    <td width="5%">
		      Above:<br/>
		      Below:</td>
		    <td width="20%">
		      <input id="be_intname" type="text" size="30" onchange="tsapp.checkBoundEditor('intname')">
		      <hr/>
		      <input id="be_lower" type="text" size="30" onchange="tsapp.checkBoundEditor('lower')"></td>
		    <td style="padding-top: 5px">
		      <input id="be_age" type="text" size="8" onchange="tsapp.checkBoundEditor('age')"> &plusmn;
		      <input id="be_age_err" type="text" size="5" onchange="tsapp.checkBoundEditor('age_err')"> &nbsp;
		      <img id="be_spike" class="tsed_spike" width="20" height="20"/> &nbsp; &nbsp;
		      <select id="be_bound_type" onchange="tsapp.checkBoundEditor('bound_type')">
			<option value="">--</option>
		      </select> &nbsp;
		      <div id="be_base_bound" style="display: inline" class="tsed_timescale_label"
			onclick="tsapp.checkBoundEditor('base_bound')">&nbsp;</div> &nbsp;
		      <div id="be_range_bound" style="display: inline" class="tsed_timescale_label"
			onclick="tsapp.checkBoundEditor('range_bound')">&nbsp;</div> &nbsp;
		      <input id="be_fraction" style="display: none" type="text" size="8"
			onchange="tsapp.checkBoundEditor('fraction')"> &nbsp;</td></tr>
		</table>
	      </form></td></tr></table>
      </td></tr>
    </table>
</div>

<!-- The following boxes are modal dialogs, and only appear when -->
<!-- timescale and bound references are being selected. -->

<div id="timescale_selector" class="tsed_modal">

  <div class="tsed_modal_content" style="height: 500px">
    <span class="close" onclick="tsapp.modalClose('timescale_selector')">&times;</span>
    <h3>Select a timescale:</h3>
    <table id="timescale_selector_timescales" style="display: block; height: 400px; overflow: scroll">
    </table>
  </div>

</div>
    

<div id="bound_selector" class="tsed_modal">

  <div class="tsed_modal_content" style="height: 500px">
    <span class="close" onclick="tsapp.closeModal('bound_selector')">&times;</span>
    <h3>Select a boundary from one of the following timescales:</h3>
    <table width="80%" style="height: 450px;" cellpadding="5">
      <tr style="vertical-align: top">
	<td width="40%">
	  <table id="bound_selector_timescales" style="display: block; height: 400px; overflow: scroll">
	  </table></td>
	 <td><table id="bound_selector_bounds" style="display: block; height: 400px; overflow: scroll">
	</table></td></tr>
    </table>
  </div>

</div>






